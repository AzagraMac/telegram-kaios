!function(){"use strict";var e,a,s,t=function(e){var a=navigator.appCodeName;try{var s=e.indexOf("Mobile;");if(-1!=s){var t=e.substring(s+8),r=t.indexOf(")");""!=(t=t.substring(0,r))&&(a=t)}}catch(e){}var p="1.0";try{if(e.indexOf("KAIOS/")>-1)p=e.substring(e.indexOf("KAIOS/"));else if(e.indexOf("Firefox/")>-1)p=e.substring(e.indexOf("Firefox/"));else if(e.indexOf("Gecko/")>-1)p=e.substring(e.indexOf("Gecko/"));else if(e.indexOf("rv:")>-1){var d=e.indexOf("rv:");if(-1!=d){var o=e.substring(d),n=o.indexOf(")");""!=(o=o.substring(0,n))&&(p=o)}}}catch(e){}return{deviceModel:a,systemVersion:p,appVersion:"1.0.0"}}(navigator.userAgent);self.onmessage=r=>{switch(r.data.type){case-100:a.disconnect().then((()=>{self.postMessage({type:-100,params:{}})})).catch((e=>{self.postMessage({type:-1,params:e})}));break;case 0:s=new telegram.sessions.MemorySession,r.data.params&&r.data.params.dcId&&r.data.params.serverAddress&&r.data.params.port&&(s.setDC(r.data.params.dcId,r.data.params.serverAddress,r.data.params.port),r.data.params.authKey&&s.setAuthKey(new telegram.AuthKey(r.data.params.authKey._key,r.data.params.authKey._hash),r.data.params.dcId)),(a=new telegram.TelegramClient(s,parseInt("YOUR_API_ID"),"YOUR_APP_HASH",{maxConcurrentDownloads:1,deviceModel:t.deviceModel,systemVersion:t.systemVersion,appVersion:t.appVersion})).addEventHandler((e=>{try{self.postMessage({type:1,params:{state:e.state,className:e.className,data:e.toJSON()}})}catch(a){self.postMessage({type:1,params:{state:e.state,className:e.className}})}})),a.connect().then((()=>{self.postMessage({type:0,params:{}})})).catch((e=>{self.postMessage({type:-1,params:e})}));break;case 2:a.invoke(new telegram.Api.auth.SendCode({phoneNumber:r.data.params.phoneNumber,apiId:r.data.params.apiId,apiHash:r.data.params.apiHash,settings:new telegram.Api.CodeSettings(r.data.params.settings)})).then((e=>{self.postMessage({type:2,params:e})})).catch((e=>{self.postMessage({type:-2,params:e.errorMessage})}));break;case 3:a.invoke(new telegram.Api.auth.SignIn({phoneNumber:r.data.params.phoneNumber,phoneCodeHash:r.data.params.phoneCodeHash,phoneCode:r.data.params.phoneCode})).then((e=>{var a={dcId:s.dcId,serverAddress:s.serverAddress,port:s.port,authKey:s.getAuthKey(s.dcId)};self.postMessage({type:3,params:{result:e.toJSON(),session:a}})})).catch((e=>{self.postMessage({type:-3,params:e.errorMessage})}));break;case 4:a.signInWithPassword({apiId:r.data.params.apiId,apiHash:r.data.params.apiHash},{password:e=>Promise.resolve(r.data.params.password),onError:e=>(self.postMessage({type:-4,params:e.errorMessage||e.toString()}),!0)}).then((e=>{var a={dcId:s.dcId,serverAddress:s.serverAddress,port:s.port,authKey:s.getAuthKey(s.dcId)};self.postMessage({type:4,params:{result:e.toJSON(),session:a}})})).catch((e=>{self.postMessage({type:-4,params:e.errorMessage||e.toString()})}));break;case 5:a.invoke(new telegram.Api.auth.ExportLoginToken({apiId:r.data.params.apiId,apiHash:r.data.params.apiHash,exceptIds:r.data.params.exceptIds})).then((e=>{self.postMessage({type:5,params:e})})).catch((e=>{self.postMessage({type:-5,params:e.errorMessage})}));break;case 6:a.invoke(new telegram.Api.auth.ExportLoginToken({apiId:r.data.params.apiId,apiHash:r.data.params.apiHash,exceptIds:r.data.params.exceptIds})).then((a=>{var t={dcId:s.dcId,serverAddress:s.serverAddress,port:s.port,authKey:s.getAuthKey(s.dcId)};e=a.token||null,self.postMessage({type:6,params:{result:a.toJSON(),session:t}})})).catch((e=>{self.postMessage({type:-6,params:e.errorMessage})}));break;case 7:a.invoke(new telegram.Api.auth.ImportLoginToken({token:e})).then((a=>{e=null;var t={dcId:s.dcId,serverAddress:s.serverAddress,port:s.port,authKey:s.getAuthKey(s.dcId)};self.postMessage({type:7,params:{result:a.toJSON(),session:t}})})).catch((e=>{self.postMessage({type:-7,params:e.errorMessage})}))}}}();
